/*! app.js - v0.1.3 - 2017-03-31 */(function(){var $,AJAX_LOADER,BACKEND_URLS,PREFIX,ShopCart,ShopFilter,closedLocation,filter_reset,getRussianDeclension,origin,parts,reload,www_hostname,slice=[].slice,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};$=jQuery.noConflict(),PREFIX="/ajax/",parts=window.location.hostname.split("."),www_hostname="www."+parts[1]+"."+parts[2],origin=window.location.origin.replace(window.location.hostname,www_hostname),window.WWW_URL=origin,window.BACKEND_URLS=BACKEND_URLS={grid:PREFIX+"products/",favourites_add_product:PREFIX+"favourites/:product_id/",search_city:PREFIX+"search/city/",search_country:PREFIX+"search/country/",search_full:PREFIX+"search/full/",env:PREFIX+"env/",cart_env:PREFIX+"cart/env/",cart_env_full:""+origin+PREFIX+"cart/env/",subscribe:PREFIX+"subscribe/",cart_counts:PREFIX+"cart/counts/"},window.CHAT_AUTOMESSAGES=["Здравствуйте. Чем я могу вам помочь?","Доставляем букеты по городам России и всему миру","Срочные заказы выполняем в течение нескольких часов","Дополнительно к цветам есть авторская коллекция подарков"],AJAX_LOADER='<img src="/static/images/ajax-loader.gif" />',reload=function(){return location.href=location.href.split("#")[0]+""},String.prototype.url=function(){var args;return(args=1<=arguments.length?slice.call(arguments,0):[])?(args=1===args.length&&"object"==typeof args[0]?args[0]:args,this.replace(/:([a-z_\-\d]+)/gi,function(match,group){return"undefined"!=typeof args[group]?args[group]:match})):this},String.prototype.add_uid=function(size){var charSet,i;return charSet="abcdefghijklmnopqrstuvwxyz",this+function(){var j,ref,results;for(results=[],i=j=1,ref=size;1<=ref?j<=ref:j>=ref;i=1<=ref?++j:--j)results.push(charSet[Math.floor(Math.random()*charSet.length)]);return results}().join("")},String.prototype.regExpEscape=function(){return this.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"$1").replace(/\x08/g,"\b")},String.prototype.lstrip=function(chars){return null==chars&&(chars="\\s"),this.replace(new RegExp("^["+chars.regExpEscape()+"]+","g"),"")},String.prototype.rstrip=function(chars){return null==chars&&(chars="\\s"),this.replace(new RegExp("["+chars.regExpEscape()+"]+$","g"),"")},String.prototype.strip=function(chars){return null==chars&&(chars="\\s"),this.lstrip().rstrip()},closedLocation=!1,$.fn.outerHTML=function(){return $(this).clone().wrap("<div></div>").parent().html()},function(){var csrfSafeMethod,getCookie,sameOrigin;getCookie=function(name){var cookie,cookieValue,cookies,i;if(cookieValue=null,document.cookie&&""!==document.cookie)for(cookies=document.cookie.split(";"),i=0;i<cookies.length;){if(cookie=jQuery.trim(cookies[i]),cookie.substring(0,name.length+1)===name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}i++}return cookieValue},csrfSafeMethod=function(method){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(method)},sameOrigin=function(url){var host,protocol,sr_origin;return host=document.location.host,protocol=document.location.protocol,sr_origin="//"+host,origin=protocol+sr_origin,url===origin||url.slice(0,origin.length+1)===origin+"/"||url===sr_origin||url.slice(0,sr_origin.length+1)===sr_origin+"/"||!/^(\/\/|http:|https:).*/.test(url)},window.csrfGet=function(){return getCookie("csrftoken")},$.ajaxSetup({beforeSend:function(xhr,settings){if(!csrfSafeMethod(settings.type)&&sameOrigin(settings.url))return xhr.setRequestHeader("X-CSRFToken",csrfGet())}})}(),$(document).on("click","[data-modal], .banner-link",function(e){var currentPopup,currentPopupId,linkData,openDialog,popupElPosition,popupId,popupModalFix,popupPosition,posData,target;if(e.preventDefault(),openDialog=function(currentEl){var arrowElPosition,resizePosition;switch(resizePosition=function(){$(popupId).closest(".ui-dialog").position({my:popupPosition,at:popupElPosition,of:currentEl,collision:"fit none",within:$("#wrapper")}),$(popupId).find(".popup-arrow").position({my:popupPosition,at:arrowElPosition,of:currentEl,collision:"fit none",within:$("#wrapper")})},currentEl.addClass("active"),$(popupId).dialog({draggable:!1,modal:!0,resizable:!1,width:"auto",position:{my:popupPosition,at:popupElPosition,of:currentEl,collision:"fit none"},open:function(event,ui){if($(ui).find(".calendar-datepicker").datepicker("enable"),$(popupId).find("input:text:visible, textarea:visible").first().focus().putCursorAtEnd(),getValidationMsgs($(popupId+" .valid-msg")),$(".ui-widget-overlay").bind("click",function(){return $(popupId).dialog("close"),currentEl.removeClass("active")}),popupModalFix)return $(event.target).parent().css("position","fixed").position({my:popupPosition,at:popupElPosition,of:currentEl,collision:"fit none"})},close:function(event,ui){$(ui).find(".calendar-datepicker").datepicker("disable"),currentEl.removeClass("active"),$(popupId).find(".popup-arrow").remove(),$(popupId).closest(".ui-dialog").css("margin-top",0),popupModalFix&&$(event.target).parent().css("position","absolute")}}),arrowElPosition="bottom+7",$(popupId).append('<span class="popup-arrow" />'),posData){case"top":arrowElPosition="top-10",$(popupId).find(".popup-arrow").addClass("top");break;case"left":arrowElPosition="right+16 center",$(popupId).find(".popup-arrow").addClass("left");break;case"right":arrowElPosition="left-16 center",$(popupId).find(".popup-arrow").addClass("right");break;case"onElement":arrowElPosition="right top-15",$(popupId).find(".popup-arrow").addClass("on-element");break;case"center":arrowElPosition="center center-14"}return $(popupId).find(".popup-arrow").position({my:popupPosition,at:arrowElPosition,of:currentEl,collision:"fit none"}),$(document).on("click",".active[data-modal]",function(){return $(popupId).dialog("close"),currentEl.removeClass("active")}),$(window).resize(function(){return resizePosition()})},target=$(this),popupId="#"+target.data("modal"),currentPopup=target.closest(".popup"),currentPopupId=currentPopup.attr("id"),posData=target.data("modalpos"),popupModalFix=+target.data("modalfix"),popupPosition="center top",popupElPosition="center bottom+21",linkData=$(".pseudo.active, .btn-dd.active, .btn-popup.active"),target.hasClass("disabled"))return!1;switch(posData){case"top":popupPosition="bottom",popupElPosition="top-24";break;case"left":popupPosition="left center",popupElPosition="right+30 center";break;case"right":popupPosition="right center",popupElPosition="left-30 center";break;case"onElement":popupPosition="left top",popupElPosition="left-30 top-15";break;case"onElementField":popupPosition="left top",popupElPosition="left-30 top-46";break;case"center":popupPosition="center top",popupElPosition="center center"}return target.hasClass("over-popup")?openDialog(target):currentPopup.size()>0?($("#"+currentPopupId).dialog("close"),openDialog(linkData),"top"!==linkData.data("modalpos")&&$(popupId).closest(".ui-dialog").removeClass("popup-top"),$(popupId).closest(".ui-dialog").css("margin-top",0)):(openDialog(target),"top"===target.data("modalpos")&&$(popupId).closest(".ui-dialog").addClass("popup-top"),target.data("customtop")?$(popupId).closest(".ui-dialog").css("margin-top",-target.data("customtop")):void 0)}),$(document).on("click",".exit-btn",function(){return $(this).closest(".popup").dialog("close")}),$(function(){return $(window).on("popstate",function(){return ShopFilter.onLocationChange()}),window.onpageshow=function(event){if(event.persisted)return window.location.reload()}}),$(function(){return $(document).on("click","button",function(e){var href;if(href=$(this).attr("href"))return e.preventDefault(),location.href=href}),$(document).on("click",".btn-action.orange",function(){if(!$(this).hasClass("btn-bouquet"))return $(this).addClass("active")}),$(".btn-bouquet").removeAttr("disabled"),$(document).on("click",".btn-bouquet",function(){return $(this).attr("disabled","disabled")})}),$(function(){return $(document).on("start",".btn-more",function(){return $(this).data("btn-text",$(this).html()),$(this).addClass("ajaxing").html(AJAX_LOADER)}).on("stop",".btn-more",function(){return $(this).removeClass("ajaxing").html($(this).data("btn-text"))})}),$(function(){return $(".showpassword").each(function(index,input){var $input;if($input=$(input),!$input.parents(".network-login").length)return $('<label class="showpasswordlabel"/>').append($("<input type='checkbox' class='showpasswordcheckbox' />").click(function(){var change,rep,t;return t=$(this),t.closest(".showpasswordlabel").toggleClass("show-pass"),change=t.is(":checked")?"text":"password",rep=$("<input type='"+change+"' />"),rep.attr({id:$input.attr("id"),name:$input.attr("name"),class:$input.attr("class")}),rep.val($input.val()).insertBefore($input),$input.remove(),$input=rep})).insertAfter($input)}),$(".user-login-form").submit(function(e){var $input,passEl,rep,t;if(e.preventDefault(),t=$(this),passEl=t.find(".show-pass"),passEl.size()>0)return passEl.removeClass("show-pass"),$input=t.find(".showpassword"),rep=$("<input type='password' />"),rep.attr({id:$input.attr("id"),name:$input.attr("name"),class:$input.attr("class")}),rep.val($input.val()).insertBefore($input),$input.remove(),$input=rep})}),$(function(){var processResponse;return processResponse=function(data,old_popup,is_plain){var popup,popup_id,trigger;return is_plain?(data.refresh&&reload(),data.url&&(location.href=data.url),data.popup?(popup=$("<div/>").append(data.popup).find(".popup"),popup_id=popup.attr("id"),$("#"+popup_id).length||$("body").append(popup.outerHTML()),$("#"+popup_id).empty().append(popup.html()),trigger=$("<span/>").attr("data-modal",popup_id),data.popup_attrs&&trigger.attr(data.popup_attrs),old_popup.append(trigger),trigger.click(),trigger.remove()):void 0):old_popup.empty().append($("<div/>").append(data).find(".popup").html())},$(document).on("submit",".popup form",function(e){var form,formData,form_action,popup,xhr;if(e.preventDefault(),form=$(this),popup=form.closest(".popup"),form_action=form.attr("action"))return formData=new FormData(form.get(0)),xhr=new XMLHttpRequest,xhr.open("POST",form_action),xhr.setRequestHeader("X-CSRFToken",csrfGet()),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.onload=function(){var is_plain,response;try{response=JSON.parse(xhr.response),is_plain=!0}catch(error){response=xhr.response,is_plain=!1}return processResponse(response,popup,is_plain)},xhr.send(formData)})}),$(function(){return $(document).on("click","[data-setenv]",function(){var data,env,t,value;if(t=$(this),env=t.data("setenv"),value=t.data("value"),env&&value)return data={},data[env]=value,$.get(BACKEND_URLS.env.url(),data,function(result){if("currency"===env&&window.location.pathname.indexOf("/bouquet/")===-1||reload(),"/checkout"===window.location.pathname&&(data={promocode:$("#promo-num").val().strip()},checkout_action("promocode",data)),"currency"===env)return price_range_reset(value)})})}),$(function(){var fix_counter_text,fix_counter_value;return fix_counter_text=function(){return $(".counter-txt").text("Благодарим за подтверждение!")},fix_counter_value=function(){var chars,countTxt,lastChar;return countTxt=$(".counter-total").text(),chars=countTxt.substr(0,countTxt.length-1),lastChar=countTxt.substr(countTxt.length-1),$(".counter-total").html(chars+"<span>"+lastChar+"</span>")},$(".counter-vote").hasClass("active")&&(fix_counter_text(),fix_counter_value()),$(document).on("click",".counter-vote",function(){var t;if(t=$(this),!t.hasClass("active"))return t.addClass("active"),fix_counter_text(),$.get(t.data("url"),function(data){return $(".counter-total").text(data.count),fix_counter_value()})})}),$(function(){var Chat,chat;return Chat=function(){function Chat(node1,params){var i,j,ref,self;if(this.node=node1,null==params&&(params={}),this.chatList=this.node.find(".chat-list"),this.chatList.empty(),this.counter=params.counter||0,this.last_counted_id=params.last_counted_id||0,this.is_displayed=params.is_displayed||!1,this.is_opened=params.is_opened||!1,this.img=params.img||null,this.chatContent=$(".chat-content"),this.backend=this.node.data("backend"),this.updater=$.PeriodicalUpdater(this.backend,{method:"post",data:{action:"lastId"},minTimeout:1e3,maxTimeout:3e3,multiplier:2,type:"json",maxCalls:0,autoStop:0,verbose:0},function(_this){return function(data,success,xhr,handle){if(data.last_id!==_this.last_id)return _this.getNewMessages()}}(this)),this.last_id=null,void 0===params.last_readed_id?this.last_readed_id=-1:this.last_readed_id=params.last_readed_id,this.messageAudio=document.createElement("audio"),this.messageAudio.innerHTML='<source src="/static/new-message.ogg" type="audio/ogg" />',void 0===params.autoMessageIndex?this.autoMessageIndex=-1:this.autoMessageIndex=params.autoMessageIndex,this.autoMessagesInterval=null,this.mCounter=this.node.find(".new-messages-counter"),this.node.find("input[type=submit]").on("click",function(_this){return function(){return _this.sendMessage()}}(this)),self=this,this.node.find("textarea").on("keypress",function(event){if((event.ctrlKey||event.metaKey)&&(10===event.keyCode||13===event.keyCode)&&$(this).val())return self.sendMessage()}),this.autoMessagesTimeout=params.autoMessagesTimeout,params.autoMessagesTimeout&&!this.is_opened&&this.startAutoMessaging(params.autoMessagesTimeout),this.is_opened?this.open():this.is_displayed&&this.close(),this.autoMessageIndex>-1){for(i=j=0,ref=this.autoMessageIndex;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j)this.newMessage(this.createAutoMessageText(i),!1);this.updateChatHeight()}this.updateMCounter()}return Chat.prototype.display=function(){return this.is_displayed=!0,this.node.addClass("chat-open").css({visibility:"visible",display:"block",position:"fixed"})},Chat.prototype.startAutoMessaging=function(timeout){var self;if(!(this.autoMessageIndex+1>=window.CHAT_AUTOMESSAGES.length-1))return"-1"!==$.cookie("cons_first")?(self=this,this.autoMessagesInterval=setInterval(function(){$(this).closest(".popup").dialog("close"),self.is_displayed||self.close(),self.newMessage(self.createAutoMessageText(++self.autoMessageIndex)),self.playSound(),self.autoMessagesInterval&&self.autoMessageIndex>=window.CHAT_AUTOMESSAGES.length-1&&clearInterval(self.autoMessagesInterval)},timeout)):void 0},Chat.prototype.createAutoMessageText=function(index){var img;return img=this.img?this.img:"/static/images/temp/chat-operator.png",'<div class="chat-item chat-operator"><span class="chat-img"><img class="img_operator" src="'+img+'" width="28" alt=""/></span><div class="chat-msg"><p>'+window.CHAT_AUTOMESSAGES[index]+"</p></div></div>"},Chat.prototype.getNewMessages=function(){return this.ajax("getNewMessages",function(_this){return function(data){var fromOperator,j,len,m,messageFromOperator,ref;for(data.messages.length&&_this.autoMessagesInterval&&clearInterval(_this.autoMessagesInterval),messageFromOperator=!1,ref=data.messages,j=0,len=ref.length;j<len;j++)m=ref[j],_this.is_opened&&(_this.last_readed_id=m.id),fromOperator=$(m.html).hasClass("chat-operator"),_this.newMessage(m.html,m.id>_this.last_counted_id,fromOperator),m.id>_this.last_counted_id&&(_this.last_counted_id=m.id),_this.last_id=Math.max(_this.last_id,m.id),messageFromOperator=messageFromOperator||fromOperator;return data.messages.length>0&&_this.last_id>_this.last_readed_id&&messageFromOperator&&_this.playSound(),_this.img&&$(".chat .img_operator").attr("src",_this.img),_this.updateChatHeight()}}(this),{last_id:this.last_id})},Chat.prototype.updateChatHeight=function(){var chatH,chatHeadH,chatListH,chatMsgBoxH;chatH=this.node.height(),chatHeadH=$(".chat .chat-head").outerHeight(!0),chatMsgBoxH=$(".chat .msg-box").outerHeight(!0),chatListH=chatH-chatHeadH-chatMsgBoxH,$(".chat .chat-content-inner").height(chatListH+"px");try{return document.getElementById("chatFlexscroll").fleXcroll.updateScrollBars()}catch(error){}},Chat.prototype.open=function(animated){var node,self,session;if(null==animated&&(animated=!1),this.is_opened=!0,this.resetCounter(),this.display(),animated?(node=this.node,self=this,this.chatContent.slideDown(300,function(){node.removeClass("collapsed"),node.css("height","60%")}),setTimeout(function(){return self.updateChatHeight()},500),setTimeout(function(){return reInitChatFlex(),self.scrollToBottom()},550)):(this.node.css("height","60%"),this.chatContent.show(),this.node.removeClass("collapsed"),this.updateChatHeight(),reInitChatFlex(),this.scrollToBottom()),this.autoMessagesInterval&&clearInterval(this.autoMessagesInterval),this.autoMessageIndex===-1&&(this.autoMessageIndex++,this.newMessage(this.createAutoMessageText(0))),session=$.cookie("chat_css"))return session=JSON.parse(session),this.img=session.img,$(".chat .chat-head ._name").text(session.name),$(".chat .img_operator").attr("src",this.img)},Chat.prototype.close=function(animated){var node;return null==animated&&(animated=!1),this.is_opened=!1,this.display(),animated?(node=this.node,this.node.css("height","auto"),this.chatContent.slideUp(300,function(){return node.addClass("collapsed")})):(this.node.css("height","auto"),this.chatContent.hide(),this.node.addClass("collapsed"))},Chat.prototype.toggle=function(){return this.is_opened?this.close:this.open},Chat.prototype.destroy=function(){return this.updater&&this.updater.stop(),this.updater=null,this.autoMessagesInterval&&clearInterval(this.autoMessagesInterval),this.node.hide(),$.cookie("cons_first","-1",{path:"/",expires:365,domain:cookie_domain})},Chat.prototype.sendMessage=function(){var txt;return txt=this.node.find("textarea"),this.ajax("send",function(data){},{message:txt.val()}),txt.val("")},Chat.prototype.newMessage=function(html,isNew,fromOperator){if(null==isNew&&(isNew=!0),null==fromOperator&&(fromOperator=!0),html)return this.chatList.append(html),isNew&&(this.is_opened?this.resetCounter():fromOperator&&this.incrementCounter()),this.is_opened?this.scrollToBottom():void 0},Chat.prototype.playSound=function(){return!1},Chat.prototype.incrementCounter=function(){return this.counter++,this.updateMCounter()},Chat.prototype.resetCounter=function(){return null===this.last_id?this.last_readed_id=-1:this.last_readed_id=this.last_id,this.counter=0,this.updateMCounter()},Chat.prototype.updateMCounter=function(){return this.counter?(this.mCounter.text(this.counter),this.mCounter.show()):this.mCounter.hide()},Chat.prototype.ajax=function(action,callback,data){return null==data&&(data={}),data.action=action,$.ajax({url:this.backend,dataType:"json",type:"POST",data:data,success:callback})},Chat.prototype.saveState=function(){var state;return!!supportsStorage()&&(state=JSON.stringify({counter:this.counter,is_opened:this.is_opened,is_displayed:this.is_displayed,img:this.img,autoMessageIndex:this.autoMessageIndex,autoMessagesTimeout:this.autoMessagesTimeout,last_readed_id:this.last_readed_id,last_counted_id:this.last_counted_id}),$.cookie("chat.state",state,{path:"/",expires:365,domain:cookie_domain}),!0)},Chat.prototype.scrollToBottom=function(){return setTimeout(function(){return fleXenv.scrollTo($(".chat-list").find("div").last().get(0))})},Chat}(),chat=!1,window.reInitChat=function(interval,firstStart){var node,params;if(null==interval&&(interval=0),null==firstStart&&(firstStart=!1),(!firstStart||"-1"!==$.cookie("cons_first"))&&(node=$(".chat"),node.length&&!chat)){if(supportsStorage())try{params=JSON.parse($.cookie("chat.state"))}catch(error){params={autoMessagesTimeout:interval}}else params={autoMessagesTimeout:interval};return chat=new Chat(node,params)}},window.reInitChatFlex=function(){fleXenv.initByClass("chat-content-inner")},$("[hashstring]").length||(reInitChat(4e4,!0),reInitChatFlex()),$(document).on("click",".operators > a, .operator > a, a.show-consultant",function(e){var img,name,self;if(e.preventDefault(),self=$(this),name=self.find(".nn"),name.length&&(name=name.html(),img=self.find("img").attr("src"),$.cookie("chat_css",JSON.stringify({name:name,img:img}),{path:"/",expires:365,domain:cookie_domain})),self.closest(".popup").dialog("close"),$.cookie("cons_first","",{path:"/",expires:365,domain:cookie_domain}),window.reInitChat(),chat)return chat.open()}),$(document).on("click",".chat-head .collapse",function(){$(this).closest(".chat").hasClass("collapsed")?chat.open(!0):chat.close(!0)}),$(document).on("click",".close-chat",function(){chat&&chat.destroy(),chat=!1}),$(window).on("beforeunload",function(){chat&&chat.saveState()})}),$(function(){var monthNames,monthNamesOr;return window.filterDatepickerExtraInfoFix=function(dp,ui3){var date,now,popup,ref;return ref=[$(dp).datepicker("getDate"),$(dp).closest(".popup"),new Date],date=ref[0],popup=ref[1],now=ref[2],$(".delivery-calendar .ui1").hide(),ui3?($(".delivery-calendar .ui2").hide(),$(".delivery-calendar .ui3").show()):($(".delivery-calendar .ui2").show(),$(".delivery-calendar .ui3").hide()),now=new Date,date.getDate()===now.getDate()&&date.getMonth()===now.getMonth()&&date.getFullYear()===date.getFullYear()?(popup.find(".delivery-dot").hide(),popup.find(".delivery-day").show()):(popup.find(".delivery-dot").show(),popup.find(".delivery-day").hide())},$.datepicker.setDefaults($.datepicker.regional.ru),monthNames=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"],monthNamesOr=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],window.datePickerReInit=function(){var defDate,dp;if(defDate=new Date($("#filter-delivery-cart-data").data("dateraw")||new Date),dp=$(".calendar-datepicker"))return dp.datepicker({numberOfMonths:2,dateFormat:"d %% yy",minDate:new Date($("#filter-delivery-cart-data").data("datemin")||new Date),defaultDate:defDate,monthNames:monthNamesOr,onSelect:function(dateText,inst){var $this,currentPopupId,date,datepickerDate2,day,linkData,month,popup,ref,selected,today,year;return today=new Date,selected=new Date,selected.setFullYear(inst.selectedYear,inst.selectedMonth,inst.selectedDay),selected<today&&(dp.datepicker("setDate",today),dateText=today.getDate()+" %% "+today.getFullYear(),inst.selectedDay=today.getDate(),inst.selectedMonth=today.getMonth(),inst.selectedYear=today.getFullYear()),$this=$(this),popup=$this.closest(".popup"),dateText=dateText.replace("%%",monthNames[inst.selectedMonth]),currentPopupId=$this.closest(".popup").attr("id"),linkData=$("body").find("[data-modal='"+currentPopupId+"']"),datepickerDate2=inst.selectedYear===(new Date).getFullYear()?inst.selectedDay+" "+monthNames[inst.selectedMonth]:dateText,linkData.closest(".filter-dd").each(function(){if(0===$(this).find(".delivery-date").length&&$(this).find(".filter-item .delivery-item").append('<span class="delivery-date" />'),0===$(this).find(".delivery-item .dashed-line").length)return $(this).find(".delivery-date").before('<span class="dashed-line">—</span>')}),$(".popup-deliv-date").html(datepickerDate2),linkData.addClass("selected").closest(".filter-dd").find(".delivery-date").text(datepickerDate2),popup.find(".filter-delivery-date").html("&mdash; "+dateText),$("#id_checkout_date").html(datepickerDate2.toLowerCase()),date=$this.datepicker("getDate"),ref=[date.getDate(),date.getMonth()+1,date.getFullYear()],day=ref[0],month=ref[1],year=ref[2],ShopCart.setDate(day+"/"+month+"/"+year,function(data){return window.filterDatepickerExtraInfoFix($this,!data.date_is_delivery),window.location.pathname.indexOf("checkout")!==-1?void checkout_action():($(".itemcard-popup, .item-card-page").trigger("reload_prices"),$(".listing-grid").trigger("reload_grid"))})}})},datePickerReInit()}),$.datepicker.regional.ru={closeText:"Закрыть",prevText:"&#x3c;Пред",nextText:"След&#x3e;",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Не",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},$(function(){var countries_complete_cache;return window.autoCompleteReInit=function(){var complete_cache;if($(".field-automlete").length)return complete_cache={},$(".field-automlete").autocomplete({minLength:0,source:function(req,resp){var term;return term=req.term,term?term in complete_cache?resp(complete_cache[term]):$.getJSON(BACKEND_URLS.search_city.url(),req,function(data){return complete_cache[term]=data,resp(data)}):resp([])},focus:function(event,ui){return $(this).closest(".popup").find(".field-automlete").val(ui.item.label+", "+ui.item.value),!1},select:function(event,ui){var $this,currentPopupId,datepicker,linkData;return $this=$(this),currentPopupId=$this.closest(".popup").attr("id"),linkData=$("body").find("[data-modal='"+currentPopupId+"']"),linkData.closest(".filter-dd").find(".delivery-city").text(ui.item.label+", "+ui.item.value),linkData.addClass("selected"),$this.val(ui.item.label),$(".delivery-calendar .extra-delivery-city").text(ui.item.label_inflected),datepicker=$this.closest(".popup").find(".calendar-datepicker"),datepicker.length&&window.filterDatepickerExtraInfoFix(datepicker),$(".popup-deliv-city").html(ui.item.label),ShopCart.setCity(ui.item.id,function(data){return window.location.pathname.indexOf("/bouquet/")!==-1?($(".item-card-page").trigger("reload_prices"),$(".listing-grid").trigger("reload_grid"),"www"!==window.location.hostname.slice(0,3)?void window.location.assign(window.WWW_URL+window.location.pathname):void(ui.item.is_subdomain&&window.location.assign(window.WWW_URL.replace("www",ui.item.is_subdomain)+window.location.pathname))):window.location.pathname.indexOf("checkout")!==-1?($("#id_checkout_city").html(ui.item.label_inflected2.split(" ")[1]),void checkout_action()):(window.location.assign(ui.item.href),window.filterDatepickerExtraInfoFix($(".calendar-datepicker"),!data.date_is_delivery))}),!1},response:function(event,ui){}}).data("autocomplete")._renderItem=function(ul,item){var x;return x=$("<li>").data("item.autocomplete",item),x.append("<a><span>"+item.label+",</span> "+item.value+"</a>").appendTo(ul)}},autoCompleteReInit(),countries_complete_cache={},$(".countries-autocomplete").autocomplete({minLength:0,source:function(req,resp){var term;return term=req.term,term?term in countries_complete_cache?resp(countries_complete_cache[term]):$.getJSON(BACKEND_URLS.search_country.url(),req,function(data){return countries_complete_cache[term]=data,resp(data)}):resp([])},focus:function(event,ui){return $(this).closest(".popup").find(".select-countries-dropdown").val(ui.item.label)},select:function(event,ui){var $this,currentPopupId,linkData;return $this=$(this),currentPopupId=$this.closest(".popup").attr("id"),linkData=$("body").find("[data-modal='"+currentPopupId+"']"),linkData.find("span").text(ui.item.label),$this.val(ui.item.label),$(".ui-widget-overlay").length&&$(".ui-widget-overlay").trigger("click"),!1},response:function(event,ui){var autocomplVal;return autocomplVal=$(".select-countries-dropdown").val(),0===ui.content.length?($(this).closest(".autocomplete-wrap").find(".automlete-not-found").show(),$(this).closest(".autocomplete-wrap").find(".automlete-not-found").find("span").text(autocomplVal)):$(this).closest(".autocomplete-wrap").find(".automlete-not-found").hide()}})}),$(function(){var am_max,am_min,disable_change,disable_first_change,price_sort_box_a;return disable_first_change=!1,disable_change=!1,window.re_setup=function(el,slider,min,max){var opt,smax,smin,v;opt={step:el.data("price-step"),min:0,max:el.data("price-maxvalue"),values:[0,el.data("price-maxvalue")],scale:el.data("price-values").split(",")},(min||max)&&(opt.values=[min,max]);try{slider.slider("destroy"),slider.siblings(".scale").html("")}catch(undefined){}if(price_slider(slider,opt),min||max)return disable_first_change=!0,$(slider).slider("values",[min,max]),v=$(slider).siblings(".amount-box"),smin=v.find(".amountmin"),smax=v.find(".amountmax"),smin.off("change"),smax.off("change"),smin.val(min),smax.val(max),smin.change(am_min),smax.change(am_max)},window.price_slider=function(el,opts){var $this,currentPopup,currentPopupId,linkData,priceHtml,scaleLength,scaleLine;return $this=$(el),currentPopup=$this.closest(".popup"),currentPopupId=currentPopup.attr("id"),linkData=$("body").find("[data-modal='"+currentPopupId+"']"),priceHtml='<span class="f-pr-range"><span class="price-min"></span><span class="price-max"></span></span>',scaleLine=opts.scale,$this.slider({range:!0,step:opts.step,min:opts.min,max:opts.max,values:opts.values,slide:function(event,ui){return!(ui.values[1]-ui.values[0]<5)&&(currentPopup.find(".amountmin").val(ui.values[0]),currentPopup.find(".amountmax").val(ui.values[1]))},change:function(event,ui){return disable_first_change?void(disable_first_change=!1):(linkData.each(function(){var dd;return dd=$(this).closest(".filter-dd"),0===dd.find(".filter-item").size()?$(this).after('<span class="filter-item">'+priceHtml+"</span>"):0===dd.find(".f-pr-range").size()&&dd.find(".filter-item").prepend(priceHtml),dd.find(".price-min").html($this.slider("values",0)+"–").attr("data-price-min",$this.slider("values",0)),dd.find(".price-max").html($this.slider("values",1)+currentPopup.find(".current-cyr").outerHTML()+'<i class="remove"></i>'),dd.find(".price-max").attr("data-price-max",$this.slider("values",1))}),disable_change?void 0:(linkData.closest(".filter-list").data("filter").updateURLQueryString(),filter_reset(linkData.closest(".filter-list").data("filter-name"))))}}),currentPopup.find(".amountmin").val($this.slider("values",0)),currentPopup.find(".amountmax").val($this.slider("values",1)),$this.find(".ui-slider-handle:first").addClass("first"),scaleLength=scaleLine.length,$.each(scaleLine,function(index,value){var lastEl,scalePos,valueToNumber;return lastEl=scaleLine[scaleLine.length-1],lastEl=lastEl.replace(/\s+/g,""),valueToNumber=parseInt(value.replace(/\s+/g,"")),scalePos=parseInt(valueToNumber/lastEl*100),scaleLength===index+1?currentPopup.find(".scale").append('<span class="last" style="right:0;">'+value+"</span>"):0===index?currentPopup.find(".scale").append('<span class="first" style="left:0;">'+value+"</span>"):currentPopup.find(".scale").append('<span style="left:'+scalePos+'%;">'+value+"</span>")})},window.re_setup_all=function(){if($(".price-range").each(function(){var el;return el=$(this).parent().find(".cy-chose .active"),re_setup(el,$(this))}),$("#filter-price-all").data("values"))return price_sort_box_a($("#filter-price-all"),"#fitertabs-all .btn-dd-price",!0)},$(document).on("click",".f-pr-range",function(){var filter,name;return filter=$(this).closest(".filter-list").data("filter"),name=$(this).closest(".filter-list").data("filter-name"),$(this).closest(".filter-item").remove(),filter.updateURLQueryString(),filter_reset(name)}),window.price_range_reset=function(currency){var c,g,text;text=$(".amount-box .cy-chose span[data-currency="+currency+"]").eq(0).text(),$(".amount-box .cy-chose span").removeClass("active"),$(".cy-chose [data-currency="+currency+"]").addClass("active"),$(".filter-price .current-cyr").text(text),$(".price-sort-box").hide(),$(".price-sort-box-"+currency).show(),$(".f-pr-range").parent().remove(),$("[data-price-min]").attr("data-price-min",0),$("[data-price-max]").attr("data-price-max",0),g=$("#fiter-tabs").find('[aria-expanded="true"]').find(".filter-list");try{g.data("filter").updateURLQueryString(!1),filter_reset(g.data("filter-name")),re_setup_all()}catch(undefined){}return $(".popup-language-currency .active").removeClass("active"),c=$(".popup-language-currency [data-value="+currency+"]"),c.addClass("active"),$("#lang-curr i").replaceWith(c.find("i").clone())},$(".amount-box .cy-chose span").click(function(){var currency,self;return self=$(this),currency=self.data("currency"),price_range_reset(currency)}),am_min=function(){var $this,currentMaxValue,minValue,value;$this=$(this),minValue=$this.parent().siblings(".price-range").slider("option","min"),value=parseInt($this.val()),currentMaxValue=parseInt($this.closest(".filter-price").find(".amountmax").val()),value<minValue||value>currentMaxValue||isNaN(value)||void 0===value?($this.val(minValue),$this.closest(".popup").find(".price-range").slider("values",0,minValue)):$this.closest(".popup").find(".price-range").slider("values",0,value)},$(document).on("change",".amount-box .amountmin",am_min),am_max=function(){var $this,currentMinValue,maxValue,value;$this=$(this),maxValue=$this.parent().siblings(".price-range").slider("option","max"),value=parseInt($this.val()),currentMinValue=parseInt($this.closest(".filter-price").find(".amountmin").val()),value>maxValue||value<currentMinValue||isNaN(value)||void 0===value?($this.val(maxValue),$this.closest(".popup").find(".price-range").slider("values",1,maxValue)):$this.closest(".popup").find(".price-range").slider("values",1,value)},$(document).on("change",".amount-box .amountmax",am_max),price_sort_box_a=function(self,slider,not_change){var m,smax,smin,v;if(slider=slider?$("#"+$(slider).data("modal")).find(".price-range"):self.parent().parent().find(".price-range"),m=self.data("values").split(","),disable_first_change=!0,not_change&&(disable_change=!0),slider.slider("values",[m[0],m[1]]),v=slider.siblings(".amount-box"),smin=v.find(".amountmin"),smax=v.find(".amountmax"),smin.off("change"),smax.off("change"),smin.val(m[0]),smax.val(m[1]),smin.change(am_min),smax.change(am_max),not_change)return disable_change=!1},$(document).on("click",".price-sort-box a",function(){return window.location.pathname.indexOf("/bouquet/")!==-1||(price_sort_box_a($(this)),!1)}),$(document).on("click",".prd-item.prd-prices a",function(){var data,values;return values=$(this).data("values"),data={select_prices:values},$.post(BACKEND_URLS.cart_env,data,function(){return window.location.assign("/")}),!1})}),ShopFilter=function(){function ShopFilter(filter,grid){var tab_href;null==grid&&(grid=".listing-grid"),this.filter=$(filter),this.filter.data("filter",this),tab_href="#"+this.filter.closest('[id|="fitertabs"]').attr("id"),this.tab_id=$("#fiter-tabs .tab-list [href='"+tab_href+"']").closest("li").index(),this.grid=$(grid),this.filterName=this.filter.data("filter-name"),this.activeClass="chosen",this.removeAllCount=5}return ShopFilter.prototype.init=function(){return this.attachCategories(),this.restoreFilter()},ShopFilter.prototype.restoreFilter=function(){var actives,catalog_prefix,el,f,filter,pathname,pmax,pmin,sf,short_pathname;if(filter=(this.filter.data("filter-params")||"").split(":"),f=this,catalog_prefix="/ru/catalog/",pathname=window.location.pathname,short_pathname=pathname.replace(catalog_prefix,""),actives=!1,short_pathname.indexOf("/")!==-1&&(actives=short_pathname.split("/")),this.categoryLinks().each(function(){var $t,a,ref,ref1;return $t=$(this),a=!1,actives&&(ref=$t.attr("href").replace(catalog_prefix,""),a=indexOf.call(actives,ref)>=0),ref1=$t.data("filter"),indexOf.call(filter,ref1)>=0||$t.attr("href")===pathname||a?f.activateCategory($t,!1):f.deactivateCategory($t,!1)}),pmin=0,pmax=0,filter.forEach(function(e){return"pmin~"===e.substr(0,5)&&(pmin=+e.substr(5)),"pmax~"===e.substr(0,5)&&(pmax=+e.substr(5)),!0}),sf=this.filter.find(".price-range"),(pmax||pmin&&pmax)&&sf.length)return el=sf.parent().find(".cy-chose .active"),re_setup(el,sf,pmin,pmax)},ShopFilter.prototype.categoryPopupsLinks=function(){return this.filter.find('[data-modal|="filter-category"]')},ShopFilter.prototype.categoryPopupLink=function(link){var popup_id;return popup_id=link.closest(".popup").attr("id"),this.categoryPopupsLinks().filter("[data-modal='"+popup_id+"']")},ShopFilter.prototype.categoryPopups=function(){var selectors;return selectors=[],this.categoryPopupsLinks().each(function(_this){return function(i,el){return selectors.push("#"+$(el).data("modal")+".popup")}}(this)),$(selectors.join(","))},ShopFilter.prototype.categoryLinks=function(){return this.categoryPopups().find(".select-category a.pseudo")},ShopFilter.prototype.attachCategories=function(){var $this,attach;return $this=this,attach=function(){return $this.categoryLinks().click(function(e){return window.location.pathname.indexOf("/bouquet/")!==-1||(e.preventDefault(),$this.categoryClick($(this)))}).each(function(i,el){return $(el).find("span").attr("data-uniq","cat-link-".add_uid(6))})},$(document).on("attach_categories",".listing-grid",function(){return attach()})},ShopFilter.prototype.activateCategory=function(link,fire_events){var filter,popup_link;if(null==fire_events&&(fire_events=!0),!link.hasClass(this.activeClass))return link.addClass(this.activeClass).find("span").append('<i class="remove"></i>'),popup_link=this.categoryPopupLink(link),0===popup_link.parent().find(".filter-item").size()&&popup_link.after('<span class="filter-item" />'),filter=popup_link.parent().find(".filter-item"),filter.append($(link.html()).click(function(_this){return function(){return _this.deactivateCategory(link)}}(this))),this.checkCategoryLinkOnChange(link,fire_events),filter_reset(this.filterName)},ShopFilter.prototype.deactivateCategory=function(link,fire_events){if(null==fire_events&&(fire_events=!0),link.hasClass(this.activeClass))return link.removeClass(this.activeClass).find(".remove").remove(),this.filter.find(".filter-item [data-uniq='"+link.find("span").data("uniq")+"']").remove(),this.checkCategoryLinkOnChange(link,fire_events),filter_reset(this.filterName)},ShopFilter.prototype.updateURLQueryString=function(update){var active,price_max,price_min,search,sf,url;if(null==update&&(update=!0),active=[this.filterName],this.categoryLinks().filter("."+this.activeClass).each(function(){if($(this).data("filter"))return active.push($(this).data("filter"))}),price_min=this.filter.find("[data-price-min]").attr("data-price-min"),price_max=this.filter.find("[data-price-max]").attr("data-price-max"),price_min&&active.push("pmin~"+price_min),price_max&&active.push("pmax~"+price_max),search=queryString.parse($(".listing-grid").data("url")),search.filter=active.join(":"),search=queryString.stringify(search),url="/",url+="?"+search,$(".listing-grid").data("url",search),update&&(window.location.pathname.indexOf("/cities/")===-1&&window.location.pathname.indexOf("/countries/")===-1&&History.pushState(null,document.title,"/"),ShopFilter.filters[this.filterName]))return sf=ShopFilter.filters[this.filterName],sf.grid.trigger("reload_grid"),[sf.tab_id,this.filterName]},ShopFilter.prototype.checkCategoryLinkOnChange=function(link,fire_events){var active,popup_link,ref;if(null==fire_events&&(fire_events=!1),ref=[this.categoryPopupLink(link),link.closest(".popup").find("."+this.activeClass).size()],popup_link=ref[0],active=ref[1],active?popup_link.addClass(this.activeClass):popup_link.removeClass(this.activeClass),fire_events)return this.updateURLQueryString()},ShopFilter.prototype.categoryClick=function(link){return link.hasClass(this.activeClass)?this.deactivateCategory(link):this.activateCategory(link)},ShopFilter.filters={},ShopFilter.init=function(){return $(".filter-list").each(function(_this){return function(i,el){var sf;return sf=new ShopFilter(el),_this.filters[sf.filterName]=sf,sf.init()}}(this)),ShopFilter.onLocationChange(!1)},ShopFilter.onLocationChange=function(reload_grid){var filter,filterName,search,sf;if(null==reload_grid&&(reload_grid=!0),search=queryString.parse($(".listing-grid").data("url")),search.filter)return filter=search.filter.split(":"),filterName=filter.shift(),ShopFilter.filters[filterName]&&(sf=ShopFilter.filters[filterName],sf.categoryLinks().each(function(){var $t,ref;return $t=$(this),ref=$t.data("filter"),indexOf.call(filter,ref)>=0?sf.activateCategory($t,!1):sf.deactivateCategory($t,!1)}),reload_grid)?sf.grid.trigger("reload_grid"):void 0},ShopFilter}(),getRussianDeclension=function(){function getRussianDeclension(number,forms){if(forms)return this.forms=forms.split(","),this.result="",/1[1-4]$/.test(number)?this.forms[2]:/[2-4]$/.test(number)?this.forms[1]:/1$/.test(number)?this.forms[0]:this.forms&&this.forms.length>2?this.forms[2]:void 0}return getRussianDeclension}(),$(function(){var active_id,btnMoreText,cart,cats,down_h,down_s,filter_h,is_appended,loc,reload_counters,top_h;return $(".listing-grid").length&&($("#fiter-tabs").length&&(is_appended=!1,filter_h=99,top_h=$("#fiter-tabs").offset().top,down_s=$(".services").length?".services":$(".current-city-box").length?".current-city-box":".content-delivery-payment",down_h=function(){var h;h=$("#fiter-tabs").height()+140;try{return $(down_s).offset().top-h}catch(error){return $(".footer").offset().top-h}},$(document).scroll(function(){var ft,t;if(t=$(window).scrollTop(),ft=$("#fiter-tabs"),t>top_h&&t<down_h()){if(!ft.hasClass("fixed"))return $(".ui-widget-overlay").click(),is_appended||(ft.after("<div id='filter-tabs-after' style='height: "+filter_h+"px'></div>"),is_appended=!0),ft.addClass("fixed"),ft.removeAttr("style"),ft.find(".filter-dd .btn-dd").data("modalfix",1)}else if(ft.hasClass("fixed"))return $(".ui-widget-overlay").click(),$("#filter-tabs-after").remove(),is_appended=!1,ft.removeClass("fixed"),ft.css({"z-index":"auto"}),ft.find(".filter-dd .btn-dd").data("modalfix",0)})),cats=$.cookie("infinite_on_many"),cats=cats?JSON.parse(cats):{},btnMoreText="",$(document).on("click",".btn-more",function(){var products,u;return products=$(".listing-grid-extra .prd-item"),$(".listing-grid:eq(0)").append(products).masonry("appended",products),$(this).hide(),u=$(".listing-grid").data("url"),cats[u]=1,$.cookie("infinite_on_many",JSON.stringify(cats),{path:"/",expires:365,domain:cookie_domain})}).on("check",".btn-more",function(e){var extGridLen,self,word;return extGridLen=$(".listing-grid-extra .prd-item").length,extGridLen?(self=$(e.target),btnMoreText||(btnMoreText=self.text()),word=getRussianDeclension(extGridLen,self.data("forms")),word?self.text(btnMoreText+" "+extGridLen+" "+word):self.text(btnMoreText),$(this).show()):$(this).hide()}),$(".btn-more").trigger("check")),!(!$("#fiter-tabs").length&&!$(".item-card-page").length)&&(ShopFilter.init(),reload_counters=function(){return $.get(BACKEND_URLS.cart_counts.url(),!1,function(data){return $('a[href="#fitertabs-seen"] small').text(data.history),$('a[href="#fitertabs-favourites"] small').text(data.favourites)})},$(document).on("reload_grid",".listing-grid",function(){var currency,lg;return currency=$(".popup-language-currency .active").data("value"),currency="&currency="+currency,lg=$("#listing-grid"),lg.css({opacity:.5}),$.get(BACKEND_URLS.grid.url(),$(".listing-grid").data("url").lstrip("?")+currency,function(data){var d;if($(".listing-grid").html("").masonry("reload"),$(".btn-more").show().trigger("start"),$(".listing-head").html(""),d=$(data.html),$(".listing-grid-extra").html(d.find(".listing-grid-extra").html()),$(".listing-grid").html(d.find(".listing-grid").html()).masonry("reload"),$(".listing-head").html(d.find(".listing-head").html()),$(".btn-more").trigger("stop").trigger("check"),$(".bubble-slider").fotorama({nav:"none"}),cats[$(".listing-grid").data("url")]&&$(".btn-more").trigger("click"),lg.css({opacity:1}),0===$(".itemcard-popup.active").length&&1===$("#catalog-ancor-element").length)return $("html, body").animate({scrollTop:$("#catalog-ancor-element").offset().top},"300")})}),$(document).on("reload_counters",".listing-grid",function(){return reload_counters()}),active_id=function(){var catalog_prefix,filterName,search,search_url,v;if(catalog_prefix="/ru/catalog/",window.location.pathname.indexOf(catalog_prefix)!==-1){v=window.location.pathname.replace(catalog_prefix,"");try{if(v=$("[href=#fitertabs-"+v+"]"),v.length)return v.parent().index()}catch(error){}}return search_url=queryString.parse(location.search),search_url.filter&&(v=search_url.filter.replace("category-",""),v=$("[href=#fitertabs-"+v+"]"),v.length)?v.parent().index():(search=queryString.parse($(".listing-grid").data("url")),search.filter?(filterName=search.filter.split(":")[0],ShopFilter.filters[filterName]?ShopFilter.filters[filterName].tab_id:0):0)},$("#fiter-tabs").tabs({create:function(event,ui){var f;if(f=ui.panel.find(".filter-list"),f.length)return f.data("filter").updateURLQueryString(!1)},activate:function(event,ui){var f,ref,tab_id,tab_name;if(f=ui.newPanel.find(".filter-list"),f.length)return ref=f.data("filter").updateURLQueryString(),tab_id=ref[0],tab_name=ref[1],ref},active:active_id()}),$(".listing-grid").length&&cats[$(".listing-grid").data("url")]&&$(".btn-more").trigger("click"),cart=$("#filter-delivery-cart-data"),cart.length&&(cart.data("cityid")&&cart.data("date")&&$.cookie("first_popup")||($("#popup-overlay").show(),$("#choose-city").show().each(function(index,element){var imgTemp;return imgTemp=$("<img />"),imgTemp.load(function(){return $(element).addClass("active")}),imgTemp.attr("src",$(element).find("img").attr("src"))}),$.cookie("first_popup",1,{path:"/",expires:365,domain:cookie_domain}))),loc=$("#choose-city"),loc.length&&loc.find(".close-popup").click(function(){return $("#choose-city").hide(),$("#popup-overlay").hide()}),$(document).on("click",".filter-delivery-info",function(){return $(this).closest(".filter-dd").find("[data-modal]").click()}))}),filter_reset=function(filter_name){var active,data,template;if(filter_name&&("all"===filter_name||"category-"===filter_name.slice(0,9)))return template='<div class="filter-dd reset"><span class="filter-item"><span class="reset">Сбросить фильтр<i class="remove"></i></span></span></div>',data=$("[data-filter-name="+filter_name+"]"),active=!1,data.find(".filter-item > span").each(function(){var self;if(self=$(this),!self.hasClass("delivery-item")&&!self.hasClass("reset"))return active=!0}),active?data.find(".reset").length?void 0:(data.append(template),data.find(".reset .filter-item .reset").click(function(){return data.find(".filter-item > span").each(function(){var self;if(self=$(this),!self.hasClass("delivery-item"))return self.remove()}),data.find(".filter-dd.reset").remove(),data.data("filter").categoryLinks().removeClass("chosen").find(".remove").remove(),data.data("filter").updateURLQueryString(),!1})):data.find(".filter-dd.reset").remove()},window.filter_reset=filter_reset,$(function(){var History,body,currentPage,init_slider,init_slider_value,intervalActive,intervalZoom,reload_prices,removeZoom,showZoom,slideShow,t;return body=document.getElementsByTagName("body")[0],init_slider_value=!1,window.reload_prices=reload_prices=function(node,url){var active_id,card_prices;return card_prices=$(node).find(".data-changed"),active_id=card_prices.find(".active[data-productid]").attr("data-productid"),init_slider_value=parseInt(card_prices.find(".count-input").val()),url||(url=window.location),$(node).find(".data-changed").load(url+" .data-changed > *",function(){var pageOuter,sliderBlock;if(active_id&&card_prices.find("[data-productid]").removeClass("active").filter("[data-productid="+active_id+"]").addClass("active"),pageOuter=$(node).find(".item-card-outer"),sliderBlock=pageOuter.find(".flower-slider"),sliderBlock.length)return init_slider(pageOuter)})},window.init_slider=init_slider=function(pageOuter){return $("#single-slider").on("reload",function(){var ci,init_val,max_count,min_count,prices,prices_economy,sliderBlock;return sliderBlock=pageOuter.find(".flower-slider"),prices=$("#single-slider .horizontal-slider-outer .prices").data("val"),prices_economy=$("#single-slider .horizontal-slider-outer .prices_economy").data("val"),min_count=parseInt($("#single-slider .horizontal-slider-outer .min-range").html()),max_count=parseInt($("#single-slider .horizontal-slider-outer .max-range").html()),ci=$(sliderBlock).siblings(".amount-container").find(".amount-container-inner").find(".count-input"),init_slider_value&&ci.val(init_slider_value),init_val=+ci.val(),$(sliderBlock).slider({value:init_val,range:"min",min:min_count,max:max_count,animate:!1,step:1,create:function(event,ui){default_position($(this),prices),priceEnter($(this),ui,10,$,min_count)},slide:function(event,ui){eventChanges($(this),event,ui,prices,min_count,prices_economy),minRng($(this),ui,min_count)},change:function(event,ui){eventChanges($(this),event,ui,prices,min_count,prices_economy)},stop:function(event,ui){minRng($(this),ui,min_count)}})}),$("#single-slider").trigger("reload")},intervalActive=!1,t=function(){if(!intervalActive)return $(".zoomContainer").remove()},intervalZoom=setInterval(t,100),removeZoom=function(img){if(intervalActive=!1,$(".zoomContainer").remove(),img)return img.removeData("elevateZoom")},showZoom=function(img){var zoom_opt;if(removeZoom(img),!img.hasClass("nz"))return intervalActive=!0,zoom_opt={zoomType:"inner",cursor:"crosshair",onZoomedImageLoaded:function(el){var id,ide,pid1,pid2,src,tmbs;return ide=$(".itemcard-popup.active #current-product-id"),id=ide.length?ide.val():$("#current-product-id").val(),pid1=("/"+id+"_").toLowerCase(),pid2=pid1.replace("_","."),src=el.attr("src").toLowerCase(),src.indexOf(pid1)===-1&&src.indexOf(pid2)===-1?void removeZoom():($(".zoomContainer").each(function(){var self;self=$(this),self.hover(function(){jQuery(".big-item-img").addClass("opacity")},function(){jQuery(".big-item-img").removeClass("opacity")}),(+self.css("left").replace("px","")<=30||+self.css("top").replace("px","")<=30)&&self.remove()}),tmbs=$(".item-thumbs-img"),$(".itemcard-popup.active").length&&(tmbs=$(".itemcard-popup.active .item-thumbs-img")),tmbs.length?$(".zoomWindow").addClass("multi"):void 0)}},img.elevateZoom(zoom_opt)},window.showZoom=showZoom,$(".item-card-page").length&&($(".item-card-page").on("reload_prices",function(){return reload_prices($(".item-card-page"))}),showZoom($(".jqzoom img").eq(0)),$(".count-input").trigger("change")),slideShow=function(clickElem){var bigImgContainer,img,imgThumb,imgWrapp,index;return clickElem=clickElem||!1,img=$("#view"+clickElem.attr("id").replace("thumb","")),showZoom(img),imgThumb=clickElem.find("img"),imgWrapp=clickElem.find(".item-thumb-img"),0===imgWrapp.length&&(imgWrapp=clickElem.find(".item-thumb-img-small")),index=clickElem.index(),bigImgContainer=$(".big-item-img"),imgWrapp.addClass("active"),clickElem.siblings().find(".item-thumb-img").removeClass("active"),clickElem.siblings().find(".item-thumb-img-small").removeClass("active"),bigImgContainer.children().eq(index).siblings().css({position:"absolute",opacity:0}).stop().fadeOut(function(){$(this).css({position:"static",opacity:1})}),bigImgContainer.children().eq(index).fadeIn(),!1},History=window.history,currentPage=window.location.href,$(document).on("click",'.block-delivered a:not([data-modal]), .cart-prd-item a:not([data-modal]):not(".no-popup"), .prd-item:not(".no-popup") a:not([data-modal]), .favorite-items a:not(".fav-link,[data-modal]"), .related-items a:not(".title,.off,[data-modal]"), .special-items a',function(e){var lnk,overlay,scrollValue;return lnk=$(this).attr("href"),History.pushState(null,null,lnk),overlay='<div class="fl-popup-overlay"><div class="cssload-container"><div class="cssload-tube-tunnel"></div></div></div>',scrollValue=$(document).scrollTop(),closedLocation===!1&&$("#location-city:visible").dialog("close"),$(".itemcard-popup").on("reload_prices",function(){return reload_prices($(".itemcard-popup"))}),$(".itemcard-popup").load(lnk+" .item-card-page",function(response,status,xhr){var currentProductInfo,initPopup,popup,removeTrash;$("#fiter-tabs .tab-list .f-seen").show(),currentProductInfo=$("#current-product-info"),$("#shop-callback-itemcard form").attr("action",currentProductInfo.data("callback-form-url")),popup=$(this),popup.find(".item-card-page").addClass("current"),initPopup=function(animSide){var closeBtn,closeBtnElem,closePopup,hp,img,itemCardContent,leftContent,nextLink,pageOuter,prevLink,prstgEnd,prstgStart,sliderBlock;window.Social&&window.Social.attach(),animSide=animSide||"left",prstgStart=100,prstgEnd=100,closeBtn='<span class="fl-close-btn" />',pageOuter=popup.find(".current").find(".item-card-outer"),leftContent=popup.find(".current").find(".left-card-content"),itemCardContent=pageOuter.find(".item-card-content"),nextLink=popup.find(".current").find(".right-arr").attr("href"),prevLink=popup.find(".current").find(".left-arr").attr("href"),"right"===animSide&&(prstgStart=-100),pageOuter.append(closeBtn),$(document).scrollTop(0),body.classList.add("popup-opened"),popup.addClass("active"),itemCardContent.css({left:prstgStart+"%",position:"relative"}),leftContent.fadeOut(0),itemCardContent.animate({left:0},{duration:750,easing:"easeInOutExpo",queue:!1,complete:function(){leftContent.fadeIn(750),change_fs(leftContent.find("h1")),BouquetConsistCollapse(),$(this).removeAttr("style")}}),$("body").append(overlay),img=$(".itemcard-popup.active .jqzoom img").eq(0),img.length||(img=$(".jqzoom img").eq(0)),showZoom(img),hp=$(".itemcard-popup.active .hidepop"),hp.length&&hp.hide(),$("body").trigger("moverun"),$(document).on("click",".item-card-price a[data-modal]",function(){var bottomPos,dataLink,modalHeight,modalId,modalTopPos,popupHeight,shadowHeight;return dataLink=$(this),modalId=dataLink.data().modal,popupHeight=popup.height(),shadowHeight=35,modalHeight=$("body").find("#"+modalId).closest(".ui-dialog").outerHeight(),modalTopPos=parseInt($("body").find("#"+modalId).closest(".ui-dialog").css("top")),bottomPos=modalHeight+modalTopPos}),closePopup=function(){$(".itemcard-popup").off("reload_prices"),$(".listing-grid").trigger("reload_counters"),removeZoom(),History.pushState(null,null,currentPage),$("#location-city:visible").dialog("close"),body.classList.remove("popup-opened"),$(document).scrollTop(scrollValue),popup.off("click"),popup.animate({opacity:0},{duration:200,easing:"easeInOutSine",queue:!1,complete:function(){removeTrash(),popup.removeAttr("style"),popup.removeClass("active"),popup.children().hide().remove(),popup.find(".product-arrows").die("click")}}),$(".fl-popup-overlay").animate({opacity:0},{duration:200,easing:"easeInOutSine",queue:!1,complete:function(){$(this).remove(),$(".item-card-page").length&&showZoom($(".jqzoom img").eq(0))}})},pageOuter.find(".fl-close-btn").length&&(closeBtnElem=pageOuter.find(".fl-close-btn"),closeBtnElem.on("click",function(){closePopup()}),$(document).on("click",".item-card-details:last-child a",function(){return pageOuter.find(".fl-close-btn").click(),!1})),$(document).on("click",".fl-popup-overlay",function(){closePopup()}),sliderBlock=pageOuter.find(".flower-slider"),sliderBlock.length&&init_slider(pageOuter),$("#fiter-tabs.fixed").removeAttr("style"),$(".tab-list").removeAttr("style")},initPopup(),removeTrash=function(){$("body").find(".fl-popup-overlay").remove(),popup.find(".removed").remove()},popup.on("click",".product-arrows",function(e){var currentSlideAnimate,itemCardContent,itemLink,itemLinkElement,leftContent,leftSlide,pageOuter,rightSlide,scrollHeight;return itemLink=$(this).attr("href"),itemLinkElement=$(this),leftContent=popup.find(".item-card-page.current").find(".left-card-content"),pageOuter=popup.find(".item-card-page.current").find(".item-card-outer"),scrollHeight=$(document).scrollTop(),itemCardContent=pageOuter.find(".item-card-content"),$("#location-city:visible").dialog("close"),closedLocation=!0,!(itemCardContent.is(":animated")||itemLinkElement.hasClass("disabled")||(itemLinkElement.addClass("disabled"),rightSlide=function(){popup.find(".current").removeClass("current").addClass("removed"),popup.find(".hidden.current").remove(),removeTrash(),popup.find(".hidden.next-item").addClass("current").removeClass("hidden").removeClass("next-item"),initPopup(),$(document).scrollTop(scrollHeight)},leftSlide=function(){popup.find(".current").removeClass("current").addClass("removed"),popup.find(".hidden.current").remove(),removeTrash(),popup.find(".prev-item").addClass("current").removeClass("hidden").removeClass("prev-item"),initPopup("right"),$(document).scrollTop(scrollHeight)},currentSlideAnimate=function(){popup.find(".hidden.next-item").length>0&&(leftContent.fadeOut(300,function(){itemCardContent.css("position","relative"),itemCardContent.animate({left:"-100%"},{duration:750,easing:"easeInOutExpo",queue:!1})}),History.pushState(null,null,itemLink),setTimeout(rightSlide,750)),popup.find(".prev-item").length>0&&(leftContent.fadeOut(300,function(){itemCardContent.css("position","relative"),itemCardContent.animate({left:"100%"},{duration:750,easing:"easeInOutExpo",queue:!1})}),History.pushState(null,null,itemLink),setTimeout(leftSlide,750))},"#"===itemLink||!itemLinkElement.length||($(this).off("click"),$.ajax({url:itemLink,async:!0,dataFilter:function(data){return $(data).find(".item-card-page")},success:function(data){data.length>0&&(itemLinkElement.hasClass("right-arr")?data.addClass("next-item hidden"):itemLinkElement.hasClass("left-arr")&&data.addClass("prev-item hidden"),popup.append(data),currentSlideAnimate())}}),1)))})}),!1}),$(window).on("popstate",function(){return $(".fl-close-btn").trigger("click"),!1}),$(document).on("reload_gifts",".checkout-gift",function(){return $(".gift-item").each(function(){var elem,elem_left,elem_right,ref;return elem=$(this),ref=[!elem.prev().hasClass("nopopup")&&elem.prev(),!elem.next().hasClass("nopopup")&&elem.next()],elem_left=ref[0],elem_right=ref[1],elem.on("click","a",function(){var addBtn,href,overlay,scrollValue;return href=$(this).attr("href"),overlay='<div class="fl-popup-overlay"></div>',scrollValue=$(document).scrollTop(),addBtn=elem.find(".btn"),$("body").append(overlay),$(".itemcard-popup").load(href+" .gift-pup-block",function(){var initPopup,popup,popupBtn;return popup=$(this),popupBtn=popup.find(".btn-action"),initPopup=function(){var closeBtn,closeBtnElem,itemCardContent,leftContent,pageOuter,zoomContainer;return zoomContainer=$("#zoom-block"),closeBtn='<span class="fl-close-btn" />',pageOuter=popup.find(".gift-pup-outer"),leftContent=popup.find(".left-card-content"),itemCardContent=pageOuter.find(".item-card-content"),pageOuter.append(closeBtn),popup.css({top:($(window).height()-popup.outerHeight())/2}).addClass("active"),body.classList.add("popup-opened"),itemCardContent.css({left:"100%"}),leftContent.fadeOut(0),itemCardContent.animate({left:"30%"},1e3,"easeInOutExpo",function(){return zoomContainer.parent().css({opacity:1}),leftContent.fadeIn(1200),change_fs(leftContent.find("h1"))}),popupBtn.on("click",function(){return addBtn.click(),pageOuter.find(".fl-close-btn").click(),!1}),$(document).on("click",".fl-popup-overlay",function(){return closeBtnElem.trigger("click")}),pageOuter.find(".fl-close-btn").length&&(closeBtnElem=pageOuter.find(".fl-close-btn"),closeBtnElem.on("click",function(){return $(".fl-popup-overlay").remove(),popup.children().remove(),body.classList.remove("popup-opened"),$(document).scrollTop(scrollValue),popupBtn.die("click")})),elem_left.length?popup.find(".product-arrows.left-arr").click(function(){return elem_left.find("a").click(),!1}):popup.find(".product-arrows.left-arr").hide(),elem_right.length?popup.find(".product-arrows.right-arr").click(function(){return elem_right.find("a").click(),!1}):popup.find(".product-arrows.right-arr").hide(),History.pushState(null,null,href)},initPopup(),!1}),!1})})}),$(".checkout-gift").trigger("reload_gifts"),$(document).on("click",".item-thumbs-img > a",function(){return slideShow($(this)),!1})}),$(function(){var validate_email;return validate_email=function(e){var emailReg;return emailReg=/^([\w\.\+-]+@([\w-]+\.)+[\w-]{2,4})?$/,e&&emailReg.test($.trim(e))},$(document).on("submit","#subscribe-form, .subscribe-form",function(e){var email,self;return e.preventDefault(),self=$(this),email=self.find("input[type=text]").val(),validate_email(email)?$.getJSON(BACKEND_URLS.subscribe,{email:email},function(data){if($(".subscribe-confirm").html($(data.html).find(".subscribe-confirm").html()),self.find("input[type=submit]").attr("data-modal","subscribe-confirm").click().removeAttr("data-modal"),"ok"===data.status)return self.find("input").attr("disabled","disabled")}):($(".subscribe-confirm").html("Некорректный электронный адрес"),void self.find("input[type=submit]").attr("data-modal","subscribe-confirm").click().removeAttr("data-modal"))})}),$(function(){return $(document).on("click",".add-favorites-btn",function(){var action,product_id,ref,t,url;return t=$(this),ref=[t.data("product-id"),t.data("action")],product_id=ref[0],action=ref[1],t.attr("disabled","disabled").html(" ..."),url=BACKEND_URLS.favourites_add_product.url({product_id:product_id}),$.getJSON(url,function(data){var prod;if($.isPlainObject(data))return"remove"===action?($(".favorite-items").find(".product_"+product_id).addClass("added animated"),setTimeout(function(){return $(".favorite-items").replaceWith(data.list)},800)):($(".favorite-items").replaceWith(data.list),prod=$(".favorite-items").find(".product_"+product_id).css({opacity:1}).addClass("added animated-in"),setTimeout(function(){return prod.removeClass("animated-in added").removeAttr("style")},800)),t.replaceWith(data.button),$("#fiter-tabs .tab-list .f-favorite").show()})}),$(document).on("click",".prd-item .remove-item",function(){var $this,remove_url;return $this=$(this),remove_url=$this.data("remove-url"),setTimeout(function(){if($this.closest(".prd-item").remove(),$(".listing-grid").masonry("reload"),remove_url)return $.get(remove_url,!1,function(){return $(".listing-grid").trigger("reload_counters")})},1001),$this.closest(".prd-item").addClass("animated")}),$(document).on("click",".item-card-info .btn-action",function(){var data,product;return product=$(".item-card-prices [data-productid].active, #single-slider"),data={task:"add_product",product_id:product.data("productid")},product.find("[name=custom_count]").length&&(data["custom_count_"+data.product_id]=product.find("[name=custom_count]").val(),data["custom_color_"+data.product_id]=product.find("[name=color_id]").val()),$.post(BACKEND_URLS.cart_env,data,function(data){return location.assign("/checkout")})})}),ShopCart=function(){function ShopCart(){}return ShopCart.setCity=function(city_id,callback){var params,suck,url;return suck=function(data){if(callback)return callback(data)},url=BACKEND_URLS.cart_env_full,params={url:url,type:"post",data:{city_id:city_id},xhrFields:{withCredentials:!0},success:suck},$.ajax(params)},ShopCart.setDate=function(date,callback){return $.post(BACKEND_URLS.cart_env,{date:date},function(data){if(callback)return callback(data)})},ShopCart}(),window.ShopCart=ShopCart,$(function(){var params,updateReviews;if($(".review-content").length)return $("#review-tabs").tabs(),params=URI.parseQuery($("#review-tabs").data("params")),updateReviews=function(o){var url;return params=$.extend({},params,o),url=new URI(window.location),url=url.query(params),$("#review-tabs").html(AJAX_LOADER).load(url+" #review-tabs > *",function(){return $("#review-tabs").tabs()}).tabs("destroy").data("params",url.query())},$(document).on("autocompleteselect",".countries-autocomplete",function(e,ui){return updateReviews({country:ui.item.value})}),$(".review-content ul.items-list li").click(function(){return updateReviews({year:$(this).data("value")})}),$(document).on("click","#review-tabs .btn-more",function(e){var div,t,url,url_params;if(t=$(this),url=t.data("url"))return url=new URI(url),url_params=$.extend({},URI.parseQuery($("#review-tabs").data("params")),url.query(!0)),div=t.data("url",null).trigger("start").closest('[id*="review-"]'),$.get(url.query(url_params),function(data){return t.trigger("stop"),data=$("<div/>").append(data),div.find(".review-item:last").after(data.find(".review-item")),div.find(".btn-more-wrapper").replaceWith(data.find(".btn-more-wrapper"))})})}),$(function(){var verifyGoDaddySSLSeal;return verifyGoDaddySSLSeal=function(){var bgHeight,bgWidth,sealId,url;return bgHeight="433",bgWidth="592",sealId="aRXDYhWyfY89cVAv4nArqYQvaoK9QkM1TWiAQBXDNPf8Na2uNIgnUDl76pLX",url="https://seal.godaddy.com/verifySeal?sealID="+sealId,window.open(url,"SealVerfication","location=yes,status=yes,resizable=yes,scrollbars=no,width="+bgWidth+",height="+bgHeight),!1;},$("#GoDaddySSLSeal").click(verifyGoDaddySSLSeal)}),$(function(){var ddBlockShow;return ddBlockShow=function(link){var closeBlock,count,ddBlock,element,linkOpen,overlay,overlay_block,parentBlock,scrollDiv;linkOpen=link||$(".dd-parent"),parentBlock=link.closest(".dd-parent"),overlay_block=$(".dd-overlay"),overlay='<div class="dd-overlay" />',ddBlock=parentBlock.find(".dd-block"),scrollDiv=document.querySelectorAll(".items-list-outer"),count=0,element=0,ddBlock.show(),linkOpen.addClass("active");for(element in scrollDiv)element=element,fleXenv.fleXcrollMain(scrollDiv[count]),count++;return $("body").append(overlay),ddBlock.hasClass("item-list")&&ddBlock.on("click","li",function(){var listItem;listItem=$(this),ddBlock.find("ul li").removeClass("active"),listItem.addClass("active"),linkOpen.hasClass("pseudo")?linkOpen.find("span").text(listItem.text()):linkOpen.text(listItem.text()),closeBlock()}),$(document).on("click",".dd-overlay",function(){return ddBlock.not(":hidden")&&closeBlock(),!1}),closeBlock=function(){return ddBlock.hide(),$("body").find(".dd-overlay").remove(),linkOpen.removeClass("active")}},$(document).on("click",".dd-parent a",function(e){return e.preventDefault(),ddBlockShow($(this))})})}).call(this),function(){"use strict";var queryString={};queryString.parse=function(str){return"string"!=typeof str?{}:(str=str.trim().replace(/^(\?|#)/,""),str?str.trim().split("&").reduce(function(ret,param){var parts=param.replace(/\+/g," ").split("="),key=parts[0],val=parts[1];return key=decodeURIComponent(key),val=void 0===val?null:decodeURIComponent(val),ret.hasOwnProperty(key)?Array.isArray(ret[key])?ret[key].push(val):ret[key]=[ret[key],val]:ret[key]=val,ret},{}):{})},queryString.stringify=function(obj){return obj?Object.keys(obj).map(function(key){var val=obj[key];return Array.isArray(val)?val.map(function(val2){return encodeURIComponent(key)+"="+encodeURIComponent(val2)}).join("&"):encodeURIComponent(key)+"="+encodeURIComponent(val)}).join("&"):""},"function"==typeof define&&define.amd?define(function(){return queryString}):"undefined"!=typeof module&&module.exports?module.exports=queryString:window.queryString=queryString}(),function(k,n){"object"==typeof exports?module.exports=n(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],n):k.URI=n(k.punycode,k.IPv6,k.SecondLevelDomains,k)}(this,function(k,n,q,r){function d(a,b){var c=1<=arguments.length,g=2<=arguments.length;if(!(this instanceof d))return c?g?new d(a,b):new d(a):new d;if(void 0===a){if(c)throw new TypeError("undefined is not a valid argument for URI");a="undefined"!=typeof location?location.href+"":""}return this.href(a),void 0!==b?this.absoluteTo(b):this}function t(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function m(a){return"Array"===u(a)}function z(a,b){var d,p,c={};if("RegExp"===u(b))c=null;else if(m(b))for(d=0,p=b.length;d<p;d++)c[b[d]]=!0;else c[b]=!0;for(d=0,p=a.length;d<p;d++)(c&&void 0!==c[a[d]]||!c&&b.test(a[d]))&&(a.splice(d,1),p--,d--);return a}function x(a,b){var c,d;if(m(b)){for(c=0,d=b.length;c<d;c++)if(!x(a,b[c]))return!1;return!0}var p=u(b);for(c=0,d=a.length;c<d;c++)if("RegExp"===p){if("string"==typeof a[c]&&a[c].match(b))return!0}else if(a[c]===b)return!0;return!1}function A(a,b){if(!m(a)||!m(b)||a.length!==b.length)return!1;a.sort(),b.sort();for(var c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;return!0}function h(a){return escape(a)}function f(a){return encodeURIComponent(a).replace(/[!'()*]/g,h).replace(/\*/g,"%2A")}function l(a){return function(b,c){return void 0===b?this._parts[a]||"":(this._parts[a]=b||null,this.build(!c),this)}}function C(a,b){return function(c,d){return void 0===c?this._parts[a]||"":(null!==c&&(c+="",c.charAt(0)===b&&(c=c.substring(1))),this._parts[a]=c,this.build(!d),this)}}var D=r&&r.URI;d.version="1.15.1";var e=d.prototype,v=Object.prototype.hasOwnProperty;d._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:d.duplicateQueryParameters,escapeQuerySpace:d.escapeQuerySpace}},d.duplicateQueryParameters=!1,d.escapeQuerySpace=!0,d.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,d.idn_expression=/[^a-z0-9\.-]/i,d.punycode_expression=/(xn--)/i,d.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,d.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,d.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/gi,d.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/},d.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},d.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,d.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},d.getDomAttribute=function(a){if(a&&a.nodeName){var b=a.nodeName.toLowerCase();return"input"===b&&"image"!==a.type?void 0:d.domAttributes[b]}},d.encode=f,d.decode=decodeURIComponent,d.iso8859=function(){d.encode=escape,d.decode=unescape},d.unicode=function(){d.encode=f,d.decode=decodeURIComponent},d.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},d.encodeQuery=function(a,b){var c=d.encode(a+"");return void 0===b&&(b=d.escapeQuerySpace),b?c.replace(/%20/g,"+"):c},d.decodeQuery=function(a,b){a+="",void 0===b&&(b=d.escapeQuerySpace);try{return d.decode(b?a.replace(/\+/g,"%20"):a)}catch(c){return a}};var y,w={encode:"encode",decode:"decode"},B=function(a,b){return function(c){try{return d[b](c+"").replace(d.characters[a][b].expression,function(c){return d.characters[a][b].map[c]})}catch(g){return c}}};for(y in w)d[y+"PathSegment"]=B("pathname",w[y]),d[y+"UrnPathSegment"]=B("urnpath",w[y]);w=function(a,b,c){return function(g){var p;p=c?function(a){return d[b](d[c](a))}:d[b],g=(g+"").split(a);for(var e=0,h=g.length;e<h;e++)g[e]=p(g[e]);return g.join(a)}},d.decodePath=w("/","decodePathSegment"),d.decodeUrnPath=w(":","decodeUrnPathSegment"),d.recodePath=w("/","encodePathSegment","decode"),d.recodeUrnPath=w(":","encodeUrnPathSegment","decode"),d.encodeReserved=B("reserved","encode"),d.parse=function(a,b){var c;return b||(b={}),c=a.indexOf("#"),-1<c&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c)),c=a.indexOf("?"),-1<c&&(b.query=a.substring(c+1)||null,a=a.substring(0,c)),"//"===a.substring(0,2)?(b.protocol=null,a=a.substring(2),a=d.parseAuthority(a,b)):(c=a.indexOf(":"),-1<c&&(b.protocol=a.substring(0,c)||null,b.protocol&&!b.protocol.match(d.protocol_expression)?b.protocol=void 0:"//"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=d.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0))),b.path=a,b},d.parseHost=function(a,b){var d,c=a.indexOf("/");if(-1===c&&(c=a.length),"["===a.charAt(0))d=a.indexOf("]"),b.hostname=a.substring(1,d)||null,b.port=a.substring(d+2,c)||null,"/"===b.port&&(b.port=null);else{var p=a.indexOf(":");d=a.indexOf("/"),p=a.indexOf(":",p+1),-1!==p&&(-1===d||p<d)?(b.hostname=a.substring(0,c)||null,b.port=null):(d=a.substring(0,c).split(":"),b.hostname=d[0]||null,b.port=d[1]||null)}return b.hostname&&"/"!==a.substring(c).charAt(0)&&(c++,a="/"+a),a.substring(c)||"/"},d.parseAuthority=function(a,b){return a=d.parseUserinfo(a,b),d.parseHost(a,b)},d.parseUserinfo=function(a,b){var c=a.indexOf("/"),g=a.lastIndexOf("@",-1<c?c:a.length-1);return-1<g&&(-1===c||g<c)?(c=a.substring(0,g).split(":"),b.username=c[0]?d.decode(c[0]):null,c.shift(),b.password=c[0]?d.decode(c.join(":")):null,a=a.substring(g+1)):(b.username=null,b.password=null),a},d.parseQuery=function(a,b){if(!a)return{};if(a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!a)return{};for(var e,h,c={},g=a.split("&"),p=g.length,f=0;f<p;f++)e=g[f].split("="),h=d.decodeQuery(e.shift(),b),e=e.length?d.decodeQuery(e.join("="),b):null,v.call(c,h)?("string"==typeof c[h]&&(c[h]=[c[h]]),c[h].push(e)):c[h]=e;return c},d.build=function(a){var b="";return a.protocol&&(b+=a.protocol+":"),a.urn||!b&&!a.hostname||(b+="//"),b+=d.buildAuthority(a)||"","string"==typeof a.path&&("/"!==a.path.charAt(0)&&"string"==typeof a.hostname&&(b+="/"),b+=a.path),"string"==typeof a.query&&a.query&&(b+="?"+a.query),"string"==typeof a.fragment&&a.fragment&&(b+="#"+a.fragment),b},d.buildHost=function(a){var b="";return a.hostname?(b=d.ip6_expression.test(a.hostname)?b+("["+a.hostname+"]"):b+a.hostname,a.port&&(b+=":"+a.port),b):""},d.buildAuthority=function(a){return d.buildUserinfo(a)+d.buildHost(a)},d.buildUserinfo=function(a){var b="";return a.username&&(b+=d.encode(a.username),a.password&&(b+=":"+d.encode(a.password)),b+="@"),b},d.buildQuery=function(a,b,c){var p,e,h,f,g="";for(e in a)if(v.call(a,e)&&e)if(m(a[e]))for(p={},h=0,f=a[e].length;h<f;h++)void 0!==a[e][h]&&void 0===p[a[e][h]+""]&&(g+="&"+d.buildQueryParameter(e,a[e][h],c),!0!==b&&(p[a[e][h]+""]=!0));else void 0!==a[e]&&(g+="&"+d.buildQueryParameter(e,a[e],c));return g.substring(1)},d.buildQueryParameter=function(a,b,c){return d.encodeQuery(a,c)+(null!==b?"="+d.encodeQuery(b,c):"")},d.addQuery=function(a,b,c){if("object"==typeof b)for(var g in b)v.call(b,g)&&d.addQuery(a,g,b[g]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");void 0===a[b]?a[b]=c:("string"==typeof a[b]&&(a[b]=[a[b]]),m(c)||(c=[c]),a[b]=(a[b]||[]).concat(c))}},d.removeQuery=function(a,b,c){var g;if(m(b))for(c=0,g=b.length;c<g;c++)a[b[c]]=void 0;else if("RegExp"===u(b))for(g in a)b.test(g)&&(a[g]=void 0);else if("object"==typeof b)for(g in b)v.call(b,g)&&d.removeQuery(a,g,b[g]);else{if("string"!=typeof b)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==c?"RegExp"===u(c)?!m(a[b])&&c.test(a[b])?a[b]=void 0:a[b]=z(a[b],c):a[b]===c?a[b]=void 0:m(a[b])&&(a[b]=z(a[b],c)):a[b]=void 0}},d.hasQuery=function(a,b,c,g){if("object"==typeof b){for(var e in b)if(v.call(b,e)&&!d.hasQuery(a,e,b[e]))return!1;return!0}if("string"!=typeof b)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(u(c)){case"Undefined":return b in a;case"Boolean":return a=Boolean(m(a[b])?a[b].length:a[b]),c===a;case"Function":return!!c(a[b],b,a);case"Array":return!!m(a[b])&&(g?x:A)(a[b],c);case"RegExp":return m(a[b])?!!g&&x(a[b],c):Boolean(a[b]&&a[b].match(c));case"Number":c=String(c);case"String":return m(a[b])?!!g&&x(a[b],c):a[b]===c;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},d.commonPath=function(a,b){var d,c=Math.min(a.length,b.length);for(d=0;d<c;d++)if(a.charAt(d)!==b.charAt(d)){d--;break}return 1>d?a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":"":("/"===a.charAt(d)&&"/"===b.charAt(d)||(d=a.substring(0,d).lastIndexOf("/")),a.substring(0,d+1))},d.withinString=function(a,b,c){c||(c={});var g=c.start||d.findUri.start,e=c.end||d.findUri.end,h=c.trim||d.findUri.trim,f=/[a-z0-9-]=["']?$/i;for(g.lastIndex=0;;){var k=g.exec(a);if(!k)break;if(k=k.index,c.ignoreHtml){var l=a.slice(Math.max(k-3,0),k);if(l&&f.test(l))continue}var l=k+a.slice(k).search(e),m=a.slice(k,l).replace(h,"");c.ignore&&c.ignore.test(m)||(l=k+m.length,m=b(m,k,l,a),a=a.slice(0,k)+m+a.slice(l),g.lastIndex=k+m.length)}return g.lastIndex=0,a},d.ensureValidHostname=function(a){if(a.match(d.invalid_hostname_characters)){if(!k)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(k.toASCII(a).match(d.invalid_hostname_characters))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]')}},d.noConflict=function(a){return a?(a={URI:this.noConflict()},r.URITemplate&&"function"==typeof r.URITemplate.noConflict&&(a.URITemplate=r.URITemplate.noConflict()),r.IPv6&&"function"==typeof r.IPv6.noConflict&&(a.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&"function"==typeof r.SecondLevelDomains.noConflict&&(a.SecondLevelDomains=r.SecondLevelDomains.noConflict()),a):(r.URI===this&&(r.URI=D),this)},e.build=function(a){return!0===a?this._deferred_build=!0:(void 0===a||this._deferred_build)&&(this._string=d.build(this._parts),this._deferred_build=!1),this},e.clone=function(){return new d(this)},e.valueOf=e.toString=function(){return this.build(!1)._string},e.protocol=l("protocol"),e.username=l("username"),e.password=l("password"),e.hostname=l("hostname"),e.port=l("port"),e.query=C("query","?"),e.fragment=C("fragment","#"),e.search=function(a,b){var c=this.query(a,b);return"string"==typeof c&&c.length?"?"+c:c},e.hash=function(a,b){var c=this.fragment(a,b);return"string"==typeof c&&c.length?"#"+c:c},e.pathname=function(a,b){if(void 0===a||!0===a){var c=this._parts.path||(this._parts.hostname?"/":"");return a?(this._parts.urn?d.decodeUrnPath:d.decodePath)(c):c}return this._parts.path=this._parts.urn?a?d.recodeUrnPath(a):"":a?d.recodePath(a):"/",this.build(!b),this},e.path=e.pathname,e.href=function(a,b){var c;if(void 0===a)return this.toString();this._string="",this._parts=d._parts();var g=a instanceof d,e="object"==typeof a&&(a.hostname||a.path||a.pathname);if(a.nodeName&&(e=d.getDomAttribute(a),a=a[e]||"",e=!1),!g&&e&&void 0!==a.pathname&&(a=a.toString()),"string"==typeof a||a instanceof String)this._parts=d.parse(String(a),this._parts);else{if(!g&&!e)throw new TypeError("invalid input");for(c in g=g?a._parts:a)v.call(this._parts,c)&&(this._parts[c]=g[c])}return this.build(!b),this},e.is=function(a){var b=!1,c=!1,g=!1,e=!1,h=!1,f=!1,k=!1,l=!this._parts.urn;switch(this._parts.hostname&&(l=!1,c=d.ip4_expression.test(this._parts.hostname),g=d.ip6_expression.test(this._parts.hostname),b=c||g,h=(e=!b)&&q&&q.has(this._parts.hostname),f=e&&d.idn_expression.test(this._parts.hostname),k=e&&d.punycode_expression.test(this._parts.hostname)),a.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return e;case"sld":return h;case"ip":return b;case"ip4":case"ipv4":case"inet4":return c;case"ip6":case"ipv6":case"inet6":return g;case"idn":return f;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return k}return null};var E=e.protocol,F=e.port,G=e.hostname;e.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\/\/)?$/,""),!a.match(d.protocol_expression)))throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return E.call(this,a,b)},e.scheme=e.protocol,e.port=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError('Port "'+a+'" contains characters other than [0-9]');return F.call(this,a,b)},e.hostname=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var c={};d.parseHost(a,c),a=c.hostname}return G.call(this,a,b)},e.host=function(a,b){return this._parts.urn?void 0===a?"":this:void 0===a?this._parts.hostname?d.buildHost(this._parts):"":(d.parseHost(a,this._parts),this.build(!b),this)},e.authority=function(a,b){return this._parts.urn?void 0===a?"":this:void 0===a?this._parts.hostname?d.buildAuthority(this._parts):"":(d.parseAuthority(a,this._parts),this.build(!b),this)},e.userinfo=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.username)return"";var c=d.buildUserinfo(this._parts);return c.substring(0,c.length-1)}return"@"!==a[a.length-1]&&(a+="@"),d.parseUserinfo(a,this._parts),this.build(!b),this},e.resource=function(a,b){var c;return void 0===a?this.path()+this.search()+this.hash():(c=d.parse(a),this._parts.path=c.path,this._parts.query=c.query,this._parts.fragment=c.fragment,this.build(!b),this)},e.subdomain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,c)||""}return c=this._parts.hostname.length-this.domain().length,c=this._parts.hostname.substring(0,c),c=new RegExp("^"+t(c)),a&&"."!==a.charAt(a.length-1)&&(a+="."),a&&d.ensureValidHostname(a),this._parts.hostname=this._parts.hostname.replace(c,a),this.build(!b),this},e.domain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.match(/\./g);return c&&2>c.length?this._parts.hostname:(c=this._parts.hostname.length-this.tld(b).length-1,c=this._parts.hostname.lastIndexOf(".",c-1)+1,this._parts.hostname.substring(c)||"")}if(!a)throw new TypeError("cannot set domain empty");return d.ensureValidHostname(a),!this._parts.hostname||this.is("IP")?this._parts.hostname=a:(c=new RegExp(t(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a)),this.build(!b),this},e.tld=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.lastIndexOf("."),c=this._parts.hostname.substring(c+1);return!0!==b&&q&&q.list[c.toLowerCase()]?q.get(this._parts.hostname)||c:c}if(!a)throw new TypeError("cannot set TLD empty");if(a.match(/[^a-zA-Z0-9-]/)){if(!q||!q.is(a))throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');c=new RegExp(t(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");c=new RegExp(t(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a)}return this.build(!b),this},e.directory=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var c=this._parts.path.length-this.filename().length-1,c=this._parts.path.substring(0,c)||(this._parts.hostname?"/":"");return a?d.decodePath(c):c}return c=this._parts.path.length-this.filename().length,c=this._parts.path.substring(0,c),c=new RegExp("^"+t(c)),this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a)),a&&"/"!==a.charAt(a.length-1)&&(a+="/"),a=d.recodePath(a),this._parts.path=this._parts.path.replace(c,a),this.build(!b),this},e.filename=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var c=this._parts.path.lastIndexOf("/"),c=this._parts.path.substring(c+1);return a?d.decodePathSegment(c):c}c=!1,"/"===a.charAt(0)&&(a=a.substring(1)),a.match(/\.?\//)&&(c=!0);var g=new RegExp(t(this.filename())+"$");return a=d.recodePath(a),this._parts.path=this._parts.path.replace(g,a),c?this.normalizePath(b):this.build(!b),this},e.suffix=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var c=this.filename(),g=c.lastIndexOf(".");return-1===g?"":(c=c.substring(g+1),c=/^[a-z0-9%]+$/i.test(c)?c:"",a?d.decodePathSegment(c):c)}if("."===a.charAt(0)&&(a=a.substring(1)),c=this.suffix())g=a?new RegExp(t(c)+"$"):new RegExp(t("."+c)+"$");else{if(!a)return this;this._parts.path+="."+d.recodePath(a)}return g&&(a=d.recodePath(a),this._parts.path=this._parts.path.replace(g,a)),this.build(!b),this},e.segment=function(a,b,c){var d=this._parts.urn?":":"/",e=this.path(),h="/"===e.substring(0,1),e=e.split(d);if(void 0!==a&&"number"!=typeof a&&(c=b,b=a,a=void 0),void 0!==a&&"number"!=typeof a)throw Error('Bad segment "'+a+'", must be 0-based integer');if(h&&e.shift(),0>a&&(a=Math.max(e.length+a,0)),void 0===b)return void 0===a?e:e[a];if(null===a||void 0===e[a])if(m(b)){e=[],a=0;for(var f=b.length;a<f;a++)(b[a].length||e.length&&e[e.length-1].length)&&(e.length&&!e[e.length-1].length&&e.pop(),e.push(b[a]))}else(b||"string"==typeof b)&&(""===e[e.length-1]?e[e.length-1]=b:e.push(b));else b?e[a]=b:e.splice(a,1);return h&&e.unshift(""),this.path(e.join(d),c)},e.segmentCoded=function(a,b,c){var e,h;if("number"!=typeof a&&(c=b,b=a,a=void 0),void 0===b){if(a=this.segment(a,b,c),m(a))for(e=0,h=a.length;e<h;e++)a[e]=d.decode(a[e]);else a=void 0!==a?d.decode(a):void 0;return a}if(m(b))for(e=0,h=b.length;e<h;e++)b[e]=d.decode(b[e]);else b="string"==typeof b||b instanceof String?d.encode(b):b;return this.segment(a,b,c)};var H=e.query;return e.query=function(a,b){if(!0===a)return d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof a){var c=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace),e=a.call(this,c);return this._parts.query=d.buildQuery(e||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this}return void 0!==a&&"string"!=typeof a?(this._parts.query=d.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):H.call(this,a,b)},e.setQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof a||a instanceof String)e[a]=void 0!==b?b:null;else{if("object"!=typeof a)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var h in a)v.call(a,h)&&(e[h]=a[h])}return this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},e.addQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return d.addQuery(e,a,void 0===b?null:b),this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},e.removeQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return d.removeQuery(e,a,b),this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},e.hasQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return d.hasQuery(e,a,b,c)},e.setSearch=e.setQuery,e.addSearch=e.addQuery,e.removeSearch=e.removeQuery,e.hasSearch=e.hasQuery,e.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},e.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},e.normalizeHostname=function(a){return this._parts.hostname&&(this.is("IDN")&&k?this._parts.hostname=k.toASCII(this._parts.hostname):this.is("IPv6")&&n&&(this._parts.hostname=n.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a)),this},e.normalizePort=function(a){return"string"==typeof this._parts.protocol&&this._parts.port===d.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a)),this},e.normalizePath=function(a){var b=this._parts.path;if(!b)return this;if(this._parts.urn)return this._parts.path=d.recodeUrnPath(this._parts.path),this.build(!a),this;if("/"===this._parts.path)return this;var c,h,f,e="";for("/"!==b.charAt(0)&&(c=!0,b="/"+b),b=b.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),c&&(e=b.substring(1).match(/^(\.\.\/)+/)||"")&&(e=e[0]);h=b.indexOf("/.."),-1!==h;)0!==h?(f=b.substring(0,h).lastIndexOf("/"),-1===f&&(f=h),b=b.substring(0,f)+b.substring(h+3)):b=b.substring(3);return c&&this.is("relative")&&(b=e+b.substring(1)),b=d.recodePath(b),this._parts.path=b,this.build(!a),this},e.normalizePathname=e.normalizePath,e.normalizeQuery=function(a){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(d.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a)),this},e.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},e.normalizeSearch=e.normalizeQuery,e.normalizeHash=e.normalizeFragment,e.iso8859=function(){var a=d.encode,b=d.decode;d.encode=escape,d.decode=decodeURIComponent;try{this.normalize()}finally{d.encode=a,d.decode=b}return this},e.unicode=function(){var a=d.encode,b=d.decode;d.encode=f,d.decode=unescape;try{this.normalize()}finally{d.encode=a,d.decode=b}return this},e.readable=function(){var a=this.clone();a.username("").password("").normalize();var b="";if(a._parts.protocol&&(b+=a._parts.protocol+"://"),a._parts.hostname&&(a.is("punycode")&&k?(b+=k.toUnicode(a._parts.hostname),a._parts.port&&(b+=":"+a._parts.port)):b+=a.host()),a._parts.hostname&&a._parts.path&&"/"!==a._parts.path.charAt(0)&&(b+="/"),b+=a.path(!0),a._parts.query){for(var c="",e=0,h=a._parts.query.split("&"),f=h.length;e<f;e++){var l=(h[e]||"").split("="),c=c+("&"+d.decodeQuery(l[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"));void 0!==l[1]&&(c+="="+d.decodeQuery(l[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}b+="?"+c.substring(1)}return b+=d.decodeQuery(a.hash(),!0)},e.absoluteTo=function(a){var e,h,b=this.clone(),c=["protocol","username","password","hostname","port"];if(this._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(a instanceof d||(a=new d(a)),b._parts.protocol||(b._parts.protocol=a._parts.protocol),this._parts.hostname)return b;for(e=0;h=c[e];e++)b._parts[h]=a._parts[h];return b._parts.path?".."===b._parts.path.substring(-2)&&(b._parts.path+="/"):(b._parts.path=a._parts.path,b._parts.query||(b._parts.query=a._parts.query)),"/"!==b.path().charAt(0)&&(c=(c=a.directory())?c:0===a.path().indexOf("/")?"/":"",b._parts.path=(c?c+"/":"")+b._parts.path,b.normalizePath()),b.build(),b},e.relativeTo=function(a){var c,e,h,f,b=this.clone().normalize();if(b._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(a=new d(a).normalize(),c=b._parts,e=a._parts,h=b.path(),f=a.path(),"/"!==h.charAt(0))throw Error("URI is already relative");if("/"!==f.charAt(0))throw Error("Cannot calculate a URI relative to another relative URI");return c.protocol===e.protocol&&(c.protocol=null),c.username!==e.username||c.password!==e.password||null!==c.protocol||null!==c.username||null!==c.password||c.hostname!==e.hostname||c.port!==e.port?b.build():(c.hostname=null,c.port=null,h===f?(c.path="",b.build()):(a=d.commonPath(b.path(),a.path()))?(e=e.path.substring(a.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../"),c.path=e+c.path.substring(a.length),b.build()):b.build())},e.equals=function(a){var b=this.clone();a=new d(a);var f,c={},e={},h={};if(b.normalize(),a.normalize(),b.toString()===a.toString())return!0;if(c=b.query(),e=a.query(),b.query(""),a.query(""),b.toString()!==a.toString()||c.length!==e.length)return!1;c=d.parseQuery(c,this._parts.escapeQuerySpace),e=d.parseQuery(e,this._parts.escapeQuerySpace);for(f in c)if(v.call(c,f)){if(m(c[f])){if(!A(c[f],e[f]))return!1}else if(c[f]!==e[f])return!1;h[f]=!0}for(f in e)if(v.call(e,f)&&!h[f])return!1;return!0},e.duplicateQueryParameters=function(a){return this._parts.duplicateQueryParameters=!!a,this},e.escapeQuerySpace=function(a){return this._parts.escapeQuerySpace=!!a,this},d}),function(k,n){"object"==typeof exports?module.exports=n(require("jquery","./URI")):"function"==typeof define&&define.amd?define(["jquery","./URI"],n):n(k.jQuery,k.URI)}(this,function(k,n){function q(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function r(d){var f=d.nodeName.toLowerCase();return"input"===f&&"image"!==d.type?void 0:n.domAttributes[f]}function d(d){return{get:function(f){return k(f).uri()[d]()},set:function(f,l){return k(f).uri()[d](l),l}}}function t(d,f){var l,n,q;return!(!r(d)||!f)&&(l=f.match(A),!(!l||!l[5]&&":"!==l[2]&&!m[l[2]])&&(q=k(d).uri(),l[5]?q.is(l[5]):":"===l[2]?(n=l[1].toLowerCase()+":",!!m[n]&&m[n](q,l[4])):(n=l[1].toLowerCase(),!!u[n]&&m[l[2]](q[n](),l[4],n))))}var u={},m={"=":function(d,f){return d===f},"^=":function(d,f){return!!(d+"").match(new RegExp("^"+q(f),"i"))},"$=":function(d,f){return!!(d+"").match(new RegExp(q(f)+"$","i"))},"*=":function(d,f,k){return"directory"===k&&(d+="/"),!!(d+"").match(new RegExp(q(f),"i"))},"equals:":function(d,f){return d.equals(f)},"is:":function(d,f){return d.is(f)}};k.each("authority directory domain filename fragment hash host hostname href password path pathname port protocol query resource scheme search subdomain suffix tld username".split(" "),function(h,f){u[f]=!0,k.attrHooks["uri:"+f]=d(f)});var z=function(d,f){return k(d).uri().href(f).toString()};k.each(["src","href","action","uri","cite"],function(d,f){k.attrHooks[f]={set:z}}),k.attrHooks.uri.get=function(d){return k(d).uri()},k.fn.uri=function(d){var f=this.first(),k=f.get(0),m=r(k);if(!m)throw Error('Element "'+k.nodeName+'" does not have either property: href, src, action, cite');if(void 0!==d){var q=f.data("uri");if(q)return q.href(d);d instanceof n||(d=n(d||""))}else{if(d=f.data("uri"))return d;d=n(f.attr(m)||"")}return d._dom_element=k,d._dom_attribute=m,d.normalize(),f.data("uri",d),d},n.prototype.build=function(d){return this._dom_element?(this._string=n.build(this._parts),this._deferred_build=!1,this._dom_element.setAttribute(this._dom_attribute,this._string),this._dom_element[this._dom_attribute]=this._string):!0===d?this._deferred_build=!0:(void 0===d||this._deferred_build)&&(this._string=n.build(this._parts),this._deferred_build=!1),this};var x,A=/^([a-zA-Z]+)\s*([\^\$*]?=|:)\s*(['"]?)(.+)\3|^\s*([a-zA-Z0-9]+)\s*$/;return x=k.expr.createPseudo?k.expr.createPseudo(function(d){return function(f){return t(f,d)}}):function(d,f,k){return t(d,k[3])},k.expr[":"].uri=x,k});